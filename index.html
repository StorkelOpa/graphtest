<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktiver Wissensgraph</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.6/dist/dist/vis-network.min.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.6/dist/vis-network.min.js"></script>
    <script type="text/javascript" src="nodes_data.js"></script>
    <style>
        /* ... (Dein CSS-Code, unverändert) ... */
    </style>
</head>
<body>
    <div id="graph-container"></div>
    <div id="sidebar">
        <div id="tree-view"></div>
        <div id="info-box-container">
            <h2>Details</h2>
            <div id="info-content"></div>
        </div>
    </div>
    <div id="legend">
        <div class="legend-item"><div class="legend-color" style="background-color: #FF6B6B"></div>Zentral</div>
        <div class="legend-item"><div class="legend-color" style="background-color: #4ECDC4"></div>Hauptinteressen</div>
        <div class="legend-item"><div class="legend-color" style="background-color: #96CEB4"></div>Unterpunkte</div>
        <div class="legend-item"><div class="legend-color" style="background-color: #FFEEAD"></div>Tools</div>
    </div>

    <script>
        // Erstelle die Nodes und Edges aus den importierten Daten
        const nodes = new vis.DataSet(nodesData);
        const edges = new vis.DataSet(edgesData);

        // Optionen für das Netzwerk
        const options = {
            nodes: {
                shape: 'dot',
                size: 20,
                font: {
                    size: 16,
                    color: '#ffffff'
                },
                borderWidth: 2,
                shadow: true,
                color: {
                    border: '#2B7CE9',
                    background: '#97C2FC'
                }
            },
            edges: {
                width: 2,
                shadow: true,
                smooth: {
                    type: 'continuous',
                    forceDirection: 'none',
                    roundness: 0.5
                },
                color: {
                    color: '#848484',
                    highlight: '#848484',
                    hover: '#848484',
                    inherit: 'from',
                    opacity: 1.0
                }
            },
            physics: {
                enabled: false
            },
            interaction: {
                hover: true,
                navigationButtons: true,
                keyboard: true
            }
        };

        // Initialisierung des Netzwerks
        const network = new vis.Network(document.getElementById('graph-container'), { nodes, edges }, options);

        // Deine Funktionen
        function createTreeView() {
            const treeView = document.getElementById('tree-view');
            treeView.innerHTML = '';

            const mainNodes = nodes.get({
                filter: function (node) {
                    return node.group === 'main';
                }
            });

            mainNodes.forEach(mainNode => {
                const folder = createTreeFolder(mainNode);
                treeView.appendChild(folder);
            });
        }

        function createTreeFolder(mainNode) {
            const folder = document.createElement('div');
            folder.classList.add('tree-folder');
            folder.innerHTML = `
                <div class="tree-folder-title">${mainNode.label}</div>
                <div class="tree-folder-content"></div>
            `;

            const subNodes = nodes.get({
                filter: function (subNode) {
                    return edges.get({
                        filter: function (edge) {
                            return edge.from === mainNode.id && subNode.group === 'sub';
                        }
                    }).map(edge => edge.to).includes(subNode.id);
                }
            });

            subNodes.forEach(subNode => {
                const subItem = createTreeItem(subNode);
                folder.querySelector('.tree-folder-content').appendChild(subItem);

                const toolNodes = nodes.get({
                    filter: function (toolNode) {
                        return edges.get({
                            filter: function (edge) {
                                return edge.from === subNode.id && toolNode.group === 'tools';
                            }
                        }).map(edge => edge.to).includes(toolNode.id);
                    }
                });

                toolNodes.forEach(toolNode => {
                    const toolItem = createTreeItem(toolNode);
                    subItem.appendChild(toolItem);
                });
            });

            // Event-Listener für das Ein- und Ausklappen der Ordner
            folder.querySelector('.tree-folder-title').addEventListener('click', function(event) {
                event.stopPropagation();
                const content = this.nextElementSibling;
                content.style.display = content.style.display === 'none' ? 'block' : 'none';
            });

            return folder;
        }

        function createTreeItem(node) {
            const item = document.createElement('div');
            item.classList.add('tree-item');
            item.innerHTML = `
                <div>${node.label}</div>
            `;

            // Event-Listener für das Auswählen eines Knotens in der Baumansicht
            item.addEventListener('click', function(event) {
                event.stopPropagation();
                selectNodeInGraph(node.id);
            });

            return item;
        }

        function selectNodeInGraph(nodeId) {
            network.selectNodes([nodeId]);
            network.focus(nodeId, {
                scale: 1.2,
                animation: {
                    duration: 500,
                    easingFunction: 'easeInOutQuad'
                }
            });
            showInfo(nodes.get(nodeId));
        }

        function showInfo(node) {
          const infoContent = document.getElementById('info-content');
          infoContent.innerHTML = '';

          const title = document.createElement('h3');
          title.textContent = node.label;
          infoContent.appendChild(title);

          if (node.group === 'sub' || node.group === 'tools') {
            const description = document.createElement('p');
            description.textContent = node.title || 'Keine Beschreibung verfügbar.';
            infoContent.appendChild(description);
          }
        }

        network.on("click", function(params) {
            if (params.nodes.length > 0) {
                const nodeId = params.nodes[0];
                const node = nodes.get(nodeId);

                // Knoten hervorheben
                nodes.update({id: nodeId, borderWidth: 4});

                // Alle anderen Knoten zurücksetzen
                nodes.getIds().filter(id => id !== nodeId).forEach(id => {
                    nodes.update({id: id, borderWidth: 2});
                });

                showInfo(node);
            } else {
                // Falls außerhalb eines Knotens geklickt wird
                nodes.getIds().forEach(id => {
                    nodes.update({id: id, borderWidth: 2});
                });
                document.getElementById('info-content').innerHTML = '';
            }
        });

        // Baumansicht initial befüllen
        createTreeView();
    </script>
</body>
</html>
