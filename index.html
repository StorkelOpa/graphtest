import { nodes as nodeDataSet, edges as edgeDataSet } from './nodes_data.js';

const graphContainer = document.getElementById('graph-container');
const treeView = document.getElementById('tree-view');
const infoContent = document.getElementById('info-content');

// Optionen für das Netzwerk
const networkOptions = {
    nodes: {
        shape: 'dot',
        size: 20,
        font: { size: 16, face: 'arial', color: '#eee' },
        borderWidth: 2,
        shadow: true
    },
    edges: {
        width: 2,
        smooth: { type: 'continuous' },
        arrows: { to: { enabled: true, scaleFactor: 0.5 } },
        color: '#eee'
    },
    groups: {
        center: { color: { background: '#FF6B6B', border: '#CC5555' } },
        main: { color: { background: '#4ECDC4', border: '#45B7AF' } },
        sub: { color: { background: '#96CEB4', border: '#7BA696' } },
        tools: { color: { background: '#FFEEAD', border: '#D4C690' } },
    },
    physics: {
        enabled: true,
        barnesHut: {
            gravitationalConstant: -3000,
            centralGravity: 0.3,
            springLength: 150,
            springConstant: 0.04,
            damping: 0.09,
            avoidOverlap: 0.5
        }
    },
    interaction: {
        hover: true,
        zoomView: true,
        dragView: true,
        multiselect: false
    }
};

// Netzwerk-Instanz erstellen
const networkData = { nodes: new vis.DataSet(nodeDataSet), edges: new vis.DataSet(edgeDataSet) };
const network = new vis.Network(graphContainer, networkData, networkOptions);

// Funktion zum Erstellen der Baumansicht
function createTreeView() {
    treeView.innerHTML = '';
    const mainNodes = networkData.nodes.get({ filter: node => node.group === 'main' });
    mainNodes.forEach(createTreeFolder);
}

// Funktion zum Erstellen eines Baumordners
function createTreeFolder(mainNode) {
    const folder = document.createElement('div');
    folder.classList.add('tree-folder');

    const titleDiv = document.createElement('div');
    titleDiv.classList.add('tree-folder-title');
    titleDiv.textContent = mainNode.label;
    titleDiv.addEventListener('click', () => toggleFolderContent(contentDiv));
    folder.appendChild(titleDiv);

    const contentDiv = document.createElement('div');
    contentDiv.classList.add('tree-folder-content');
    folder.appendChild(contentDiv);

    const subNodes = networkData.nodes.get({
        filter: subNode => networkData.edges.get({
            filter: edge => edge.from === mainNode.id && subNode.group === 'sub'
        }).map(edge => edge.to).includes(subNode.id)
    });
    subNodes.forEach(subNode => createTreeItem(subNode, contentDiv, 'sub'));

    treeView.appendChild(folder);
}

// Funktion zum Erstellen eines Baum-Items
function createTreeItem(node, parentElement, type) {
    const itemDiv = document.createElement('div');
    itemDiv.classList.add('tree-item');
    itemDiv.textContent = node.label;
    itemDiv.addEventListener('click', (event) => {
        event.stopPropagation();
        selectNodeInGraph(node.id);
    });
    parentElement.appendChild(itemDiv);

    if (type === 'sub') {
        const toolNodes = networkData.nodes.get({
            filter: toolNode => networkData.edges.get({
                filter: edge => edge.from === node.id && toolNode.group === 'tools'
            }).map(edge => edge.to).includes(toolNode.id)
        });
        toolNodes.forEach(toolNode => createTreeItem(toolNode, itemDiv, 'tool')); // Beachten Sie die Übergabe von itemDiv als parentElement
    }
}

// Funktion zum Ein- und Ausklappen des Ordnerinhalts
function toggleFolderContent(contentElement) {
    contentElement.style.display = contentElement.style.display === 'none' ? 'block' : 'none';
}

// Funktion zum Auswählen eines Knotens im Graphen
function selectNodeInGraph(nodeId) {
    network.selectNodes([nodeId]);
    network.focus(nodeId, {
        scale: 1.2,
        animation: { duration: 500, easingFunction: 'easeInOutQuad' }
    });
    showInfo(networkData.nodes.get(nodeId));
}

// Funktion zum Anzeigen der Knoteninformationen
function showInfo(node) {
    infoContent.innerHTML = '';
    const title = document.createElement('h3');
    title.textContent = node.label;
    infoContent.appendChild(title);

    if (node.group === 'sub' || node.group === 'tools') {
        const description = document.createElement('p');
        description.textContent = node.title || 'Keine Beschreibung verfügbar.';
        infoContent.appendChild(description);
    }
}

// Event Listener für Klicks auf den Graphen
network.on("click", function(params) {
    if (params.nodes.length > 0) {
        const nodeId = params.nodes[0];
        // Knoten hervorheben
        networkData.nodes.update({ id: nodeId, borderWidth: 4 });
        // Alle anderen Knoten zurücksetzen
        networkData.nodes.getIds().filter(id => id !== nodeId).forEach(id => {
            networkData.nodes.update({ id: id, borderWidth: 2 });
        });
        showInfo(networkData.nodes.get(nodeId));
    } else {
        // Falls außerhalb eines Knotens geklickt wird
        networkData.nodes.getIds().forEach(id => {
            networkData.nodes.update({ id: id, borderWidth: 2 });
        });
        infoContent.innerHTML = '';
    }
});

// Initialisiere die Baumansicht
createTreeView();
